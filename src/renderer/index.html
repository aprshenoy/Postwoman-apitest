
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosterBoy - API Testing Tool</title>

    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">       <!-- Updated -->
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/tables.css">
    <link rel="stylesheet" href="css/workspace.css">     <!-- Updated -->
    <link rel="stylesheet" href="css/request-builder.css">
    <link rel="stylesheet" href="css/response.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/missing-components.css">
    <link rel="stylesheet" href="css/load-testing.css">
    <link rel="stylesheet" href="css/drag-drop.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/resize.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="css/utilities.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/environment-variables.css">
    <link rel="stylesheet" href="css/folder.css">
    <link rel="stylesheet" href="css/complete-missing.css">
    <link rel="stylesheet" href="css/modern-design.css">
    <!-- Add before other stylesheets -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
<div class="logo-section">
    <img src="../../assets/icon.png" alt="PosterBoy" class="logo-image">
    <h1>PosterBoy</h1>
    <span class="version">v1.0.0</span>
</div>
<div class="header-controls">
    <div class="environment-selector">
        <select id="currentEnvironment" class="environment-dropdown" title="Current Environment">
            <option value="">Select Environment</option>
        </select>
    </div>
    <!-- Add this user profile section -->
    <div class="user-profile">
        <button class="user-profile-btn" onclick="window.AuthManager && window.AuthManager.showProfileMenu ? window.AuthManager.showProfileMenu(event) : console.log('AuthManager not ready')">
            <span class="user-avatar">👤</span>
            <span class="user-name">Demo User</span>
            <span class="dropdown-arrow">▼</span>
        </button>
    </div>
</div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Icon Sidebar -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <button class="nav-item active" data-section="workspace" data-tooltip="Workspace" onclick="showSection('workspace')">
                        <span class="nav-icon">🚀</span>
                    </button>
                    <button class="nav-item" data-section="collections" data-tooltip="Collections" onclick="showSection('collections')">
                        <span class="nav-icon">📁</span>
                    </button>
                    <button class="nav-item" data-section="history" data-tooltip="History" onclick="showSection('history')">
                        <span class="nav-icon">📜</span>
                    </button>
                    <button class="nav-item" data-section="environments" data-tooltip="Environments" onclick="showSection('environments')">
                        <span class="nav-icon">🌍</span>
                    </button>
                    <button class="nav-item" data-section="teams" data-tooltip="Teams" onclick="showSection('teams')">
                        <span class="nav-icon">👥</span>
                    </button>
                    <button class="nav-item" data-section="load-testing" data-tooltip="Load Testing" onclick="showSection('load-testing')">
    <span class="nav-icon">🔥</span>
</button>
                </nav>
            </aside>

            <!-- Requests Sidebar -->
<aside class="requests-sidebar" id="requestsSidebar">
    <div class="requests-header">
        <h3>Requests</h3>
        <div class="collection-selector">
            <select id="requestsCollectionSelect" class="collection-dropdown" onchange="loadCollectionRequests()">
                <option value="">Select Collection</option>
            </select>
        </div>
        <div class="collection-actions">
            <button class="collection-action-btn" onclick="createCollection()" title="New Collection">
                📁 New Collection
            </button>
        </div>
    </div>
    <div class="requests-list" id="requestsList">
        <div class="empty-requests">
            <h4>No Collection Selected</h4>
            <p>Choose a collection to view its requests</p>
        </div>
    </div>
</aside>



            <!-- Content Area -->
            <main class="content-area">
<section id="workspace" class="content-section active">
    <div class="workspace-container">
        <!-- Request Builder -->
        <div class="request-builder compact">
            <!-- Request Controls Row -->
            <div class="request-controls-row">
                <input type="text" id="requestName" class="request-name-input" placeholder="New Request">
                <div class="request-actions">
                    <button class="btn btn-secondary" onclick="createNewRequest()">New</button>
                    <button class="btn btn-secondary" onclick="saveCurrentRequest()">Save</button>
                    <button class="btn btn-secondary" onclick="toggleCurlSection()">cURL</button>
                </div>
            </div>

            <!-- Rest of your existing content stays the same -->
            <div class="request-line">
                <select id="method" class="method-select" onchange="updateCurlCommand()">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="PATCH">PATCH</option>
                    <option value="DELETE">DELETE</option>
                    <option value="HEAD">HEAD</option>
                    <option value="OPTIONS">OPTIONS</option>
                </select>
                <input type="text" id="url" class="url-input" placeholder="Enter request URL (use {{variables}})" oninput="updateCurlCommand()">
                <button id="sendBtn" class="send-button" onclick="sendRequest()">Send Request</button>
            </div>

        <div class="request-tabs">
            <button class="tab-btn active" data-tab="params" onclick="switchTab('params')">Parameters</button>
            <button class="tab-btn" data-tab="headers" onclick="switchTab('headers')">Headers</button>
            <button class="tab-btn" data-tab="auth" onclick="switchTab('auth')">Authorization</button>
            <button class="tab-btn" data-tab="body" onclick="switchTab('body')">Body</button>
            <button class="tab-btn" data-tab="cookies" onclick="switchTab('cookies')">Cookies</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content compact">
            <!-- Parameters Tab -->
            <div id="params" class="tab-pane active">
                <div class="section-header compact">
                    <h3>Query Parameters</h3>
                    <button class="btn-add" onclick="addParam()">+ Add Parameter</button>
                </div>
                <div id="paramsContainer" class="key-value-container">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Headers Tab -->
            <div id="headers" class="tab-pane">
                <div class="section-header compact">
                    <h3>Request Headers</h3>
                    <button class="btn-add" onclick="addHeader()">+ Add Header</button>
                </div>
                <div id="headersContainer" class="key-value-container">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Authorization Tab -->
            <div id="auth" class="tab-pane">
                <div class="section-header compact">
                    <h3>Authorization</h3>
                    <select id="authType" onchange="toggleAuthFields()">
                        <option value="none">No Auth</option>
                        <option value="bearer">Bearer Token</option>
                        <option value="basic">Basic Auth</option>
                        <option value="apikey">API Key</option>
                    </select>
                </div>
                <div class="auth-content">
                    <div id="bearerAuth" class="auth-fields" style="display: none;">
                        <label for="bearerToken">Bearer Token:</label>
                        <input type="password" id="bearerToken" placeholder="Enter bearer token (use {{variables}})" oninput="updateCurlCommand()">
                    </div>
                    <div id="basicAuth" class="auth-fields" style="display: none;">
                        <label for="basicUsername">Username:</label>
                        <input type="text" id="basicUsername" placeholder="Enter username (use {{variables}})" oninput="updateCurlCommand()">
                        <label for="basicPassword">Password:</label>
                        <input type="password" id="basicPassword" placeholder="Enter password (use {{variables}})" oninput="updateCurlCommand()">
                    </div>
                    <div id="apikeyAuth" class="auth-fields" style="display: none;">
                        <label for="apikeyKey">Key:</label>
                        <input type="text" id="apikeyKey" placeholder="API Key name" oninput="updateCurlCommand()">
                        <label for="apikeyValue">Value:</label>
                        <input type="password" id="apikeyValue" placeholder="API Key value (use {{variables}})" oninput="updateCurlCommand()">
                        <label for="apikeyLocation">Add to:</label>
                        <select id="apikeyLocation" onchange="updateCurlCommand()">
                            <option value="header">Header</option>
                            <option value="query">Query Parameter</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Body Tab -->
            <div id="body" class="tab-pane">
                <div class="section-header compact">
                    <h3>Request Body</h3>
                    <select id="bodyType" onchange="toggleBodyFields()">
                        <option value="none">No Body</option>
                        <option value="json">JSON</option>
                        <option value="form">Form Data</option>
                        <option value="raw">Raw Text</option>
                    </select>
                </div>
                <div class="body-content">
                    <div id="jsonBody" class="body-fields" style="display: none;">
                        <textarea id="jsonInput" placeholder='{"key": "value"}' rows="8" oninput="updateCurlCommand()"></textarea>
                        <button class="btn-format" onclick="formatJSON()">Format JSON</button>
                    </div>
                    <div id="formBody" class="body-fields" style="display: none;">
                        <div class="section-header compact">
                            <button class="btn-add" onclick="addFormData()">+ Add Field</button>
                        </div>
                        <div id="formDataContainer" class="key-value-container">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    <div id="rawBody" class="body-fields" style="display: none;">
                        <textarea id="rawInput" placeholder="Enter raw text data" rows="8" oninput="updateCurlCommand()"></textarea>
                    </div>
                </div>
            </div>

            <!-- Cookies Tab -->
            <div id="cookies" class="tab-pane">
                <div class="section-header compact">
                    <h3>Cookies</h3>
                    <button class="btn-add" onclick="addCookie()">+ Add Cookie</button>
                </div>
                <div id="cookiesContainer" class="key-value-container">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
        
        </div>
        <!-- cURL Section -->
        <div id="curlSection" class="curl-section">
            <div class="section-header">
                <h3>🔧 cURL Command</h3>
                <button class="btn-copy" onclick="copyCurl()">Copy</button>
            </div>
            <pre id="curlCode" class="curl-code"></pre>
        </div>

        <!-- Response Section -->
        <div class="response-section compact">
            <h3>Response</h3>
            <div id="responseContainer" class="response-container">
                <div class="response-placeholder">
                    <p>Send a request to see the response here</p>
                </div>
            </div>
        </div>
    </div>
</section>

                <!-- Collections Section -->
                <section id="collections" class="content-section">
                    <div class="section-header">
                        <h2>📁 Collections</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" onclick="createCollection()">+ Create Collection</button>
                            <button class="btn btn-secondary" onclick="importPostmanCollection()">📥 Import</button>
                            <button class="btn btn-secondary" onclick="exportAllCollections()">📤 Export All</button>
                        </div>
                    </div>
                    <div id="collectionsContainer" class="collections-container">
                        <!-- Dynamic content -->
                    </div>
                </section>

                <!-- History Section -->
                <section id="history" class="content-section">
                    <div class="section-header">
                        <h2>📜 Request History</h2>
                        <div class="section-actions">
                            <button class="btn btn-secondary" onclick="exportHistory()">📤 Export</button>
                            <button class="btn btn-secondary" onclick="importHistory()">📥 Import</button>
                            <button class="btn btn-danger" onclick="clearHistory()">🗑️ Clear All</button>
                        </div>
                    </div>
                    <div id="historyContainer" class="history-container">
                        <!-- Dynamic content -->
                    </div>
                </section>

                <!-- Environments Section -->
                <section id="environments" class="content-section">
                    <div class="section-header">
                        <h2>🌍 Environments</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" onclick="createEnvironment()">+ Create Environment</button>
                            <button class="btn btn-secondary" onclick="importEnvironments()">📥 Import</button>
                            <button class="btn btn-secondary" onclick="exportEnvironments()">📤 Export All</button>
                        </div>
                    </div>
                    <div id="environmentsContainer" class="environments-container">
                        <!-- Dynamic content -->
                    </div>
                </section>

                <!-- Teams Section -->
                <section id="teams" class="content-section">
                    <div class="section-header">
                        <h2>👥 Teams</h2>
                    </div>
                    <div id="teamsContainer" class="teams-container">
                        <!-- Dynamic content -->
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Environment Modal -->
    <div id="envModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Environment Variables</h3>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="envSelect">Environment:</label>
                    <select id="envSelect" onchange="loadVariables()">
                        <!-- Dynamic options -->
                    </select>
                </div>
                <div class="section-header">
                    <h4>Variables</h4>
                    <button class="btn-add" onclick="addVariable()">+ Add Variable</button>
                </div>
                <div id="envVariablesContainer" class="env-variables-container">
                    <!-- Dynamic content -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveEnvironment()">Save Environment</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Collection Modal -->
    <div id="collectionModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="collectionModalTitle">Collection Details</h3>
                <button class="close" onclick="closeCollectionModal()">&times;</button>
            </div>
            <div id="collectionModalBody" class="modal-body">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Save Request Modal -->
    <div id="saveRequestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💾 Save Request</h3>
                <button class="close" onclick="closeSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="requestName">Request Name:</label>
                    <input type="text" id="requestName" placeholder="Enter request name" required>
                </div>
                <div class="form-group">
                    <label for="requestDescription">Description:</label>
                    <textarea id="requestDescription" rows="3" placeholder="Optional description"></textarea>
                </div>
                <div class="form-group">
                    <label for="targetCollection">Target Collection:</label>
                    <select id="targetCollection" required>
                        <option value="">Select Collection</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveToCollection()">Save Request</button>
                <button class="btn btn-secondary" onclick="closeSaveModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <!-- Dynamic content -->
    </div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- 1. Configuration (must be first) -->
<script src="js/services/config.js"></script>

<!-- 2. Supabase Client -->
<script src="js/services/supabase-client.js"></script>

<!-- 3. Services -->
<script src="js/services/auth-service.js"></script>
<script src="js/services/team-service.js"></script>
<script src="js/services/collection-service.js"></script>
<script src="js/services/sync-service.js"></script>

    <!-- Scripts -->
    <script src="js/core.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/database-adapter.js"></script>
    <script src="js/electron-integration.js"></script>
    <script src="js/environment-manager.js"></script>
    <script src="js/collection-manager.js"></script>
    <script src="js/history-manager.js"></script>
    <script src="js/request-manager.js"></script>
    <script src="js/teams-manager.js"></script>
    <script src="js/import-manager.js"></script>
    <script src="js/user-manager.js"></script>
    <script src="js/environment-ui.js"></script>
    <script src="js/auth-manager.js"></script>
    <script src="js/load-testing-manager.js"></script>
    <script src="js/resize-manager.js"></script>
    <script src="js/app.js"></script>



<!-- Complete Global Scripts Section - Replace entire scripts section in index.html -->

<!-- IMPORTANT: Global Manager Setup and Verification -->
<script>
    // Global Manager Setup and Verification
    (function() {
        console.log('🔧 Setting up global managers...');
        
        // Wait for all managers to be loaded
        function waitForManagers() {
            return new Promise((resolve) => {
                const checkManagers = () => {
                    const managersReady = [
                        'CollectionManager',
                        'HistoryManager', 
                        'EnvironmentManager',
                        'TeamsManager',
                        'UserManager',
                        'RequestManager',
                        'ImportManager',
                        'UI'
                    ].every(managerName => {
                        return window[managerName] && typeof window[managerName] === 'object';
                    });
                    
                    if (managersReady) {
                        resolve();
                    } else {
                        setTimeout(checkManagers, 50);
                    }
                };
                checkManagers();
            });
        }
        
        // Set up global manager functions
        waitForManagers().then(() => {
            console.log('✅ All managers loaded, setting up global access...');
            
            // Verify each manager and its key methods
            const managers = {
                CollectionManager: window.CollectionManager,
                HistoryManager: window.HistoryManager,
                EnvironmentManager: window.EnvironmentManager, 
                TeamsManager: window.TeamsManager,
                UserManager: window.UserManager,
                RequestManager: window.RequestManager,
                ImportManager: window.ImportManager,
                UI: window.UI
            };
            
            Object.entries(managers).forEach(([name, manager]) => {
                if (!manager) {
                    console.error(`❌ ${name} not found!`);
                    return;
                }
                
                // Make sure the manager is globally accessible
                window[name] = manager;
                
                // Log available methods for debugging
                const methods = Object.getOwnPropertyNames(Object.getPrototypeOf(manager))
                    .filter(method => typeof manager[method] === 'function' && method !== 'constructor');
                
                console.log(`✅ ${name} loaded with methods:`, methods.slice(0, 5).join(', '), methods.length > 5 ? '...' : '');
            });
            
            console.log('🎉 All global managers verified and ready!');
            
            // Emit ready event
            if (window.Core) {
                window.Core.emit('managers-ready');
            }
            
            // Initialize requests sidebar
            initializeRequestsSidebar();
            
            // Initialize folder functionality
            initializeFolderFunctionality();
        });
    })();
</script>

<!-- Complete Global Function Aliases -->
<script>
    // Complete Global Function Aliases - Covers ALL manager methods called from HTML
    console.log('🔧 Setting up complete global function aliases...');

    // ================== UI METHODS ==================
    window.showSection = (section) => {
        try {
            if (window.UI && typeof window.UI.showSection === 'function') {
                window.UI.showSection(section);
            } else {
                console.warn('UI.showSection not available yet');
            }
        } catch (error) {
            console.error('Error in showSection:', error);
        }
    };

    window.switchTab = (tab) => {
        try {
            if (window.UI && typeof window.UI.showTab === 'function') {
                window.UI.showTab(tab);
            } else {
                console.warn('UI.showTab not available yet');
            }
        } catch (error) {
            console.error('Error in switchTab:', error);
        }
    };

    window.toggleAuthFields = () => {
        try {
            if (window.UI && typeof window.UI.toggleAuthFields === 'function') {
                window.UI.toggleAuthFields();
            } else {
                console.warn('UI.toggleAuthFields not available yet');
            }
        } catch (error) {
            console.error('Error in toggleAuthFields:', error);
        }
    };

    window.toggleBodyFields = () => {
        try {
            if (window.UI && typeof window.UI.toggleBodyFields === 'function') {
                window.UI.toggleBodyFields();
            } else {
                console.warn('UI.toggleBodyFields not available yet');
            }
        } catch (error) {
            console.error('Error in toggleBodyFields:', error);
        }
    };

    window.formatJSON = () => {
        try {
            if (window.UI && typeof window.UI.formatJSON === 'function') {
                window.UI.formatJSON();
            } else {
                console.warn('UI.formatJSON not available yet');
            }
        } catch (error) {
            console.error('Error in formatJSON:', error);
        }
    };

    // ================== REQUEST MANAGER METHODS ==================
    window.addParam = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.addParamRow === 'function') {
                window.RequestManager.addParamRow();
            } else {
                console.warn('RequestManager.addParamRow not available yet');
            }
        } catch (error) {
            console.error('Error in addParam:', error);
        }
    };

    window.addHeader = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.addHeaderRow === 'function') {
                window.RequestManager.addHeaderRow();
            } else {
                console.warn('RequestManager.addHeaderRow not available yet');
            }
        } catch (error) {
            console.error('Error in addHeader:', error);
        }
    };

    window.addCookie = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.addCookieRow === 'function') {
                window.RequestManager.addCookieRow();
            } else {
                console.warn('RequestManager.addCookieRow not available yet');
            }
        } catch (error) {
            console.error('Error in addCookie:', error);
        }
    };

    window.addFormData = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.addFormDataRow === 'function') {
                window.RequestManager.addFormDataRow();
            } else {
                console.warn('RequestManager.addFormDataRow not available yet');
            }
        } catch (error) {
            console.error('Error in addFormData:', error);
        }
    };

    window.sendRequest = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.sendRequest === 'function') {
                window.RequestManager.sendRequest();
            } else {
                console.warn('RequestManager.sendRequest not available yet');
            }
        } catch (error) {
            console.error('Error in sendRequest:', error);
        }
    };

    window.updateCurlCommand = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.updateCurlCommand === 'function') {
                window.RequestManager.updateCurlCommand();
            } else {
                console.warn('RequestManager.updateCurlCommand not available yet');
            }
        } catch (error) {
            console.error('Error in updateCurlCommand:', error);
        }
    };

    window.toggleCurlSection = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.toggleCurlSection === 'function') {
                window.RequestManager.toggleCurlSection();
            } else {
                console.warn('RequestManager.toggleCurlSection not available yet');
            }
        } catch (error) {
            console.error('Error in toggleCurlSection:', error);
        }
    };

    window.copyCurl = () => {
        try {
            if (window.RequestManager && typeof window.RequestManager.copyCurl === 'function') {
                window.RequestManager.copyCurl();
            } else {
                console.warn('RequestManager.copyCurl not available yet');
            }
        } catch (error) {
            console.error('Error in copyCurl:', error);
        }
    };

    // Enhanced saveCurrentRequest to use smart save
    window.saveCurrentRequest = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.saveCurrentRequest === 'function') {
                window.CollectionManager.saveCurrentRequest();
            } else if (window.RequestManager && typeof window.RequestManager.saveCurrentRequest === 'function') {
                window.RequestManager.saveCurrentRequest();
            } else {
                console.warn('saveCurrentRequest not available yet');
            }
        } catch (error) {
            console.error('Error in saveCurrentRequest:', error);
        }
    };

    // ================== COLLECTION MANAGER METHODS ==================
    window.createCollection = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.createCollection === 'function') {
                window.CollectionManager.createCollection();
            } else {
                console.warn('CollectionManager.createCollection not available yet');
            }
        } catch (error) {
            console.error('Error in createCollection:', error);
        }
    };

window.importPostmanCollection = () => {
    try {
        // Check if managers are ready
        if (!window.ImportManager) {
            alert('Import functionality is not ready yet. Please wait a moment and try again.');
            return;
        }
        
        if (!window.CollectionManager) {
            alert('Collection manager is not ready yet. Please wait a moment and try again.');
            return;
        }
        
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none'; // Hide the input
        
        // Handle file selection
        const handleFileSelect = async (event) => {
            try {
                // Remove the input from DOM immediately after getting files
                if (input.parentNode) {
                    input.parentNode.removeChild(input);
                }
                
                // Process the import
                if (window.ImportManager && window.ImportManager.handleCollectionImport) {
                    await window.ImportManager.handleCollectionImport(event);
                } else {
                    throw new Error('ImportManager.handleCollectionImport not available');
                }
            } catch (error) {
                console.error('Import error:', error);
                alert('Error importing collection: ' + error.message);
            }
        };
        
        // Add event listener
        input.addEventListener('change', handleFileSelect, { once: true }); // Use once: true to auto-remove listener
        
        // Add to DOM temporarily and trigger click
        document.body.appendChild(input);
        input.click();
        
        // Clean up if no file was selected (after a delay)
        setTimeout(() => {
            if (input.parentNode) {
                input.parentNode.removeChild(input);
            }
        }, 1000);
        
    } catch (error) {
        console.error('Error in importPostmanCollection:', error);
        alert('Error setting up import: ' + error.message);
    }
};

window.exportAllCollections = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.exportAllCollections === 'function') {
                window.CollectionManager.exportAllCollections();
            } else {
                console.warn('CollectionManager.exportAllCollections not available yet');
            }
        } catch (error) {
            console.error('Error in exportAllCollections:', error);
        }
    };

    // Collection-specific global functions (called from generated HTML)
    ['openCollection', 'deleteCollection', 'duplicateCollection', 'renameCollection', 
     'showCollectionMenu', 'exportCollection', 'addCurrentRequestToCollection', 
     'removeRequestFromCollection', 'loadRequestFromCollection', 'editRequest',
     'closeModal', 'closeSaveModal', 'saveToCollection', 'runCollection',
     'handleCreateCollection', 'handleRenameCollection', 'handleEditRequest', 
     'handleAddCurrentRequestToCollection'].forEach(methodName => {
        window[methodName] = (...args) => {
            try {
                if (window.CollectionManager && typeof window.CollectionManager[methodName] === 'function') {
                    return window.CollectionManager[methodName](...args);
                } else {
                    console.warn(`CollectionManager.${methodName} not available yet`);
                }
            } catch (error) {
                console.error(`Error in ${methodName}:`, error);
            }
        };
    });

    // ================== FOLDER FUNCTIONALITY ==================

    // Folder creation and management
    window.createFolderFromSidebar = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.createFolderFromSidebar === 'function') {
                window.CollectionManager.createFolderFromSidebar();
            } else {
                console.warn('CollectionManager.createFolderFromSidebar not available yet');
            }
        } catch (error) {
            console.error('Error in createFolderFromSidebar:', error);
        }
    };

    window.showCreateFolderModal = (collectionId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.showCreateFolderModal === 'function') {
                window.CollectionManager.showCreateFolderModal(collectionId);
            } else {
                console.warn('CollectionManager.showCreateFolderModal not available yet');
            }
        } catch (error) {
            console.error('Error in showCreateFolderModal:', error);
        }
    };

    window.handleCreateFolder = (event, collectionId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.handleCreateFolder === 'function') {
                return window.CollectionManager.handleCreateFolder(event, collectionId);
            } else {
                console.warn('CollectionManager.handleCreateFolder not available yet');
            }
        } catch (error) {
            console.error('Error in handleCreateFolder:', error);
        }
    };

    window.editFolder = (collectionId, folderId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.editFolder === 'function') {
                window.CollectionManager.editFolder(collectionId, folderId);
            } else {
                console.warn('CollectionManager.editFolder not available yet');
            }
        } catch (error) {
            console.error('Error in editFolder:', error);
        }
    };

    window.handleEditFolder = (event, collectionId, folderId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.handleEditFolder === 'function') {
                return window.CollectionManager.handleEditFolder(event, collectionId, folderId);
            } else {
                console.warn('CollectionManager.handleEditFolder not available yet');
            }
        } catch (error) {
            console.error('Error in handleEditFolder:', error);
        }
    };

    window.deleteFolder = (collectionId, folderId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.deleteFolder === 'function') {
                window.CollectionManager.deleteFolder(collectionId, folderId);
            } else {
                console.warn('CollectionManager.deleteFolder not available yet');
            }
        } catch (error) {
            console.error('Error in deleteFolder:', error);
        }
    };

    // Collection selection modal functions
    window.proceedWithSelectedCollection = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.proceedWithSelectedCollection === 'function') {
                window.CollectionManager.proceedWithSelectedCollection();
            } else {
                console.warn('CollectionManager.proceedWithSelectedCollection not available yet');
            }
        } catch (error) {
            console.error('Error in proceedWithSelectedCollection:', error);
        }
    };

    window.createCollectionThenFolder = () => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.createCollectionThenFolder === 'function') {
                window.CollectionManager.createCollectionThenFolder();
            } else {
                console.warn('CollectionManager.createCollectionThenFolder not available yet');
            }
        } catch (error) {
            console.error('Error in createCollectionThenFolder:', error);
        }
    };

    // Sidebar folder functions
    window.toggleSidebarFolder = (folderId) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.toggleSidebarFolder === 'function') {
                window.CollectionManager.toggleSidebarFolder(folderId);
            } else {
                console.warn('CollectionManager.toggleSidebarFolder not available yet');
            }
        } catch (error) {
            console.error('Error in toggleSidebarFolder:', error);
        }
    };

    window.loadFolderRequestToWorkspace = (collectionId, folderId, requestIndex) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.loadFolderRequestToWorkspace === 'function') {
                window.CollectionManager.loadFolderRequestToWorkspace(collectionId, folderId, requestIndex);
            } else {
                console.warn('CollectionManager.loadFolderRequestToWorkspace not available yet');
            }
        } catch (error) {
            console.error('Error in loadFolderRequestToWorkspace:', error);
        }
    };

    // ================== ENVIRONMENT MANAGER METHODS ==================
    window.createEnvironment = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.createEnvironment === 'function') {
                window.EnvironmentManager.createEnvironment();
            } else {
                console.warn('EnvironmentManager.createEnvironment not available yet');
            }
        } catch (error) {
            console.error('Error in createEnvironment:', error);
        }
    };

    window.importEnvironments = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.importEnvironments === 'function') {
                window.EnvironmentManager.importEnvironments();
            } else {
                console.warn('EnvironmentManager.importEnvironments not available yet');
            }
        } catch (error) {
            console.error('Error in importEnvironments:', error);
        }
    };

    window.exportEnvironments = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.exportEnvironments === 'function') {
                window.EnvironmentManager.exportEnvironments();
            } else {
                console.warn('EnvironmentManager.exportEnvironments not available yet');
            }
        } catch (error) {
            console.error('Error in exportEnvironments:', error);
        }
    };

    window.closeModal = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.closeModal === 'function') {
                window.EnvironmentManager.closeModal();
            } else {
                console.warn('EnvironmentManager.closeModal not available yet');
            }
        } catch (error) {
            console.error('Error in closeModal:', error);
        }
    };

    window.loadVariables = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.loadVariables === 'function') {
                window.EnvironmentManager.loadVariables();
            } else {
                console.warn('EnvironmentManager.loadVariables not available yet');
            }
        } catch (error) {
            console.error('Error in loadVariables:', error);
        }
    };

    window.addVariable = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.addVariable === 'function') {
                window.EnvironmentManager.addVariable();
            } else {
                console.warn('EnvironmentManager.addVariable not available yet');
            }
        } catch (error) {
            console.error('Error in addVariable:', error);
        }
    };

    window.saveEnvironment = () => {
        try {
            if (window.EnvironmentManager && typeof window.EnvironmentManager.saveEnvironment === 'function') {
                window.EnvironmentManager.saveEnvironment();
            } else {
                console.warn('EnvironmentManager.saveEnvironment not available yet');
            }
        } catch (error) {
            console.error('Error in saveEnvironment:', error);
        }
    };

    // Environment-specific global functions (called from generated HTML)
    ['editEnvironment', 'setActiveEnvironment', 'duplicateEnvironment', 'deleteEnvironment', 
     'openModal', 'exportEnvironment', 'handleCreateEnvironment', 'handleDuplicateEnvironment'].forEach(methodName => {
        window[methodName] = (...args) => {
            try {
                if (window.EnvironmentManager && typeof window.EnvironmentManager[methodName] === 'function') {
                    return window.EnvironmentManager[methodName](...args);
                } else {
                    console.warn(`EnvironmentManager.${methodName} not available yet`);
                }
            } catch (error) {
                console.error(`Error in ${methodName}:`, error);
            }
        };
    });

    // ================== HISTORY MANAGER METHODS ==================
    window.exportHistory = () => {
        try {
            if (window.HistoryManager && typeof window.HistoryManager.exportHistory === 'function') {
                window.HistoryManager.exportHistory();
            } else {
                console.warn('HistoryManager.exportHistory not available yet');
            }
        } catch (error) {
            console.error('Error in exportHistory:', error);
        }
    };

    window.importHistory = () => {
        try {
            if (window.HistoryManager && typeof window.HistoryManager.importHistory === 'function') {
                window.HistoryManager.importHistory();
            } else {
                console.warn('HistoryManager.importHistory not available yet');
            }
        } catch (error) {
            console.error('Error in importHistory:', error);
        }
    };

    window.clearHistory = () => {
        try {
            if (window.HistoryManager && typeof window.HistoryManager.clearHistory === 'function') {
                window.HistoryManager.clearHistory();
            } else {
                console.warn('HistoryManager.clearHistory not available yet');
            }
        } catch (error) {
            console.error('Error in clearHistory:', error);
        }
    };

    // History-specific global functions (called from generated HTML)
    ['loadFromHistory', 'showDetails', 'saveToCollection', 'removeFromHistory', 
     'exportHistoryItem', 'searchHistory', 'filterByMethod', 'filterByStatus'].forEach(methodName => {
        window[methodName] = (...args) => {
            try {
                if (window.HistoryManager && typeof window.HistoryManager[methodName] === 'function') {
                    return window.HistoryManager[methodName](...args);
                } else {
                    console.warn(`HistoryManager.${methodName} not available yet`);
                }
            } catch (error) {
                console.error(`Error in ${methodName}:`, error);
            }
        };
    });

    // ================== TEAMS MANAGER METHODS ==================
    // Teams-specific global functions (called from generated HTML)
    ['createTeam', 'joinTeam', 'selectTeam', 'showTeamDetails', 'showTeamMenu', 
     'inviteMembers', 'manageTeam', 'shareCollection', 'shareEnvironment', 
     'leaveTeam', 'deleteTeam', 'exportTeam', 'handleCreateTeam', 'handleJoinByLink', 
     'handleJoinByCode', 'browsePublicTeams'].forEach(methodName => {
        window[methodName] = (...args) => {
            try {
                if (window.TeamsManager && typeof window.TeamsManager[methodName] === 'function') {
                    return window.TeamsManager[methodName](...args);
                } else {
                    console.warn(`TeamsManager.${methodName} not available yet`);
                }
            } catch (error) {
                console.error(`Error in ${methodName}:`, error);
            }
        };
    });

    // ================== REQUESTS SIDEBAR FUNCTIONS ==================
// Fixed loadCollectionRequests to handle missing collection selection
window.loadCollectionRequests = () => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.loadCollectionRequests === 'function') {
            // Ensure we have a collection selected before trying to load
            const select = document.getElementById('requestsCollectionSelect');
            if (select && (!select.value || select.value === '')) {
                // Try to auto-select first collection
                if (window.CollectionManager.ensureCollectionSelected) {
                    window.CollectionManager.ensureCollectionSelected();
                }
                return;
            }
            
            window.CollectionManager.loadCollectionRequests();
        } else {
            console.warn('CollectionManager.loadCollectionRequests not available yet');
        }
    } catch (error) {
        console.error('Error in loadCollectionRequests:', error);
    }
};
    window.loadRequestToWorkspace = (collectionId, requestIndex) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.loadRequestFromCollection === 'function') {
                window.CollectionManager.loadRequestFromCollection(collectionId, requestIndex);
                
                // Update active state
                document.querySelectorAll('.request-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const clickedItem = document.querySelector(`[onclick="loadRequestToWorkspace('${collectionId}', ${requestIndex})"]`);
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            } else {
                console.warn('CollectionManager.loadRequestFromCollection not available yet');
            }
        } catch (error) {
            console.error('Error in loadRequestToWorkspace:', error);
        }
    };

    window.createNewRequest = () => {
        try {
            if (window.UI && typeof window.UI.clearForm === 'function') {
                window.UI.clearForm();
                
                // Set focus to request name
                const nameInput = document.getElementById('requestName');
                if (nameInput) {
                    nameInput.focus();
                }
            } else {
                console.warn('UI.clearForm not available yet');
            }
        } catch (error) {
            console.error('Error in createNewRequest:', error);
        }
    };

    // ================== HISTORY SIDEBAR FUNCTIONS ==================
    window.loadHistoryToWorkspace = (index) => {
        try {
            if (window.HistoryManager && window.HistoryManager.loadFromHistory) {
                window.HistoryManager.loadFromHistory(index);
                
                // Update active state
                document.querySelectorAll('.request-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const clickedItem = document.querySelector(`[onclick="loadHistoryToWorkspace(${index})"]`);
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            } else {
                console.warn('HistoryManager.loadFromHistory not available yet');
            }
        } catch (error) {
            console.error('Error in loadHistoryToWorkspace:', error);
        }
    };

    window.saveHistoryToCollection = (index) => {
        try {
            if (window.HistoryManager && window.HistoryManager.saveToCollection) {
                window.HistoryManager.saveToCollection(index);
            } else {
                console.warn('HistoryManager.saveToCollection not available yet');
            }
        } catch (error) {
            console.error('Error in saveHistoryToCollection:', error);
        }
    };

    // ================== UTILITY FUNCTIONS ==================
    // Placeholder functions for header controls
    window.showNotifications = () => {
        if (window.UI && window.UI.showNotification) {
            window.UI.showNotification('Notifications', 'Notification center coming soon!', { type: 'info' });
        } else {
            console.log('Show notifications clicked');
        }
    };

    window.showSettings = () => {
        if (window.UI && window.UI.showNotification) {
            window.UI.showNotification('Settings', 'Settings panel coming soon!', { type: 'info' });
        } else {
            console.log('Show settings clicked');
        }
    };

    // Enhanced sidebar functions
    window.updateSidebarForSection = (sectionName) => {
        try {
            if (window.CollectionManager && typeof window.CollectionManager.updateSidebarForSection === 'function') {
                window.CollectionManager.updateSidebarForSection(sectionName);
            } else if (window.UI && typeof window.UI.updateSidebarForSection === 'function') {
                window.UI.updateSidebarForSection(sectionName);
            } else {
                console.warn('updateSidebarForSection not available yet');
            }
        } catch (error) {
            console.error('Error in updateSidebarForSection:', error);
        }
    };

    // ================== DEBUG FUNCTIONS ==================
    
    // Debug function to check folder functionality
    window.debugFolderFunctionality = () => {
        console.log('🔍 Debugging folder functionality...');
        console.log('CollectionManager:', window.CollectionManager);
        
        if (window.CollectionManager) {
            console.log('Available methods:', Object.getOwnPropertyNames(Object.getPrototypeOf(window.CollectionManager)));
            console.log('showCreateFolderModal:', typeof window.CollectionManager.showCreateFolderModal);
            console.log('Collections:', window.CollectionManager.collections?.length || 0);
        }
        
        const selectedCollection = document.getElementById('requestsCollectionSelect')?.value;
        console.log('Selected collection:', selectedCollection);
        
        if (selectedCollection && window.CollectionManager) {
            const collection = window.CollectionManager.getCollection(selectedCollection);
            console.log('Collection details:', collection);
            console.log('Folders in collection:', collection?.folders?.length || 0);
        }
    };

    // Test folder creation
    window.testFolderCreation = () => {
        console.log('🧪 Testing folder creation...');
        
        if (!window.CollectionManager) {
            console.error('❌ CollectionManager not available');
            return;
        }
        
        const collections = window.CollectionManager.collections || [];
        if (collections.length === 0) {
            console.error('❌ No collections available');
            return;
        }
        
        const firstCollection = collections[0];
        console.log('✅ Testing with collection:', firstCollection.name);
        
        try {
            window.CollectionManager.showCreateFolderModal(firstCollection.id);
            console.log('✅ Modal opened successfully');
        } catch (error) {
            console.error('❌ Error opening modal:', error);
        }
    };

    console.log('✅ Complete global function aliases set up successfully');
</script>

<!-- Requests Sidebar JavaScript -->
<script>
    // Initialize Requests Sidebar
    function initializeRequestsSidebar() {
        console.log('🔧 Initializing requests sidebar...');
        
        // Wait for CollectionManager to be ready
        const waitForCollectionManager = () => {
            if (window.CollectionManager && window.CollectionManager.collections) {
                updateCollectionDropdown();
                
                // Listen for collection updates
                if (window.Core && typeof window.Core.on === 'function') {
                    window.Core.on('collectionsUpdated', updateCollectionDropdown);
                }
                
                // Also listen for direct collection manager events
                if (window.CollectionManager.saveCollections) {
                    const originalSave = window.CollectionManager.saveCollections;
                    window.CollectionManager.saveCollections = function() {
                        originalSave.call(this);
                        updateCollectionDropdown();
                        
                        // Update current requests list if a collection is selected
                        const select = document.getElementById('requestsCollectionSelect');
                        if (select && select.value) {
                            if (window.CollectionManager.updateRequestsList) {
                                window.CollectionManager.updateRequestsList(select.value);
                            }
                        }
                    };
                }
            } else {
                // Retry after a short delay
                setTimeout(waitForCollectionManager, 100);
            }
        };
        
        waitForCollectionManager();
    }

    function updateCollectionDropdown() {
        const select = document.getElementById('requestsCollectionSelect');
        if (!select || !window.CollectionManager) return;
        
        const collections = window.CollectionManager.collections || [];
        
        // Store current selection
        const currentValue = select.value;
        
        select.innerHTML = '<option value="">Select Collection</option>';
        
        collections.forEach(collection => {
            const option = document.createElement('option');
            option.value = collection.id;
            option.textContent = `${collection.name} (${window.CollectionManager.getTotalRequestCount ? window.CollectionManager.getTotalRequestCount(collection) : collection.requests.length})`;
            select.appendChild(option);
        });
        
        // Restore selection if it still exists
        if (currentValue && collections.find(c => c.id === currentValue)) {
            select.value = currentValue;
            if (window.CollectionManager.updateRequestsList) {
                window.CollectionManager.updateRequestsList(currentValue);
            }
        }
        
        console.log(`📁 Updated collection dropdown with ${collections.length} collections`);
    }

    function getUrlPath(url) {
        try {
            return new URL(url).pathname;
        } catch (e) {
            return url;
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>

<!-- Folder Functionality Initialization -->
<script>
    // Initialize folder functionality after everything loads
    function initializeFolderFunctionality() {
        console.log('🔧 Initializing folder functionality...');
        
        setTimeout(() => {
            if (window.CollectionManager) {
                // Ensure all collections have folders array
                if (window.CollectionManager.collections) {
                    let updated = false;
                    window.CollectionManager.collections.forEach(collection => {
                        if (!collection.folders) {
                            collection.folders = [];
                            updated = true;
                        }
                    });
                    
                    if (updated) {
                        window.CollectionManager.saveCollections();
                    }
                }
                
                console.log('✅ Folder functionality initialized');
            } else {
                console.warn('⚠️ CollectionManager not available for folder initialization');
            }
        }, 1000);
    }
</script>

<!-- Final Status Check -->
<script>
    // Final initialization check
    setTimeout(() => {
        console.log('🔍 Final initialization status check:');
        console.log('- Core:', window.Core ? '✅' : '❌');
        console.log('- UI:', window.UI ? '✅' : '❌');
        console.log('- CollectionManager:', window.CollectionManager ? '✅' : '❌');
        console.log('- RequestManager:', window.RequestManager ? '✅' : '❌');
        console.log('- HistoryManager:', window.HistoryManager ? '✅' : '❌');
        console.log('- EnvironmentManager:', window.EnvironmentManager ? '✅' : '❌');
        console.log('- TeamsManager:', window.TeamsManager ? '✅' : '❌');
        console.log('- UserManager:', window.UserManager ? '✅' : '❌');
        console.log('- ImportManager:', window.ImportManager ? '✅' : '❌');
        console.log('- App:', window.app ? '✅' : '❌');
        
        // Test folder functionality
        if (window.CollectionManager && window.CollectionManager.collections) {
            console.log('📁 Collections with folder support:', window.CollectionManager.collections.length);
            console.log('🧪 Run window.testFolderCreation() to test folder creation');
            console.log('🔍 Run window.debugFolderFunctionality() for debugging');
        }
    }, 3000);
</script>
<!-- Enhanced Global Function Aliases for new features -->
<script>
console.log('🔧 Setting up enhanced global function aliases...');

// ================== COLLECTION SWITCHING ==================
window.loadCollectionRequests = () => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.loadCollectionRequests === 'function') {
            window.CollectionManager.loadCollectionRequests();
        } else {
            console.warn('CollectionManager.loadCollectionRequests not available yet');
        }
    } catch (error) {
        console.error('Error in loadCollectionRequests:', error);
    }
};

// ================== REQUEST CREATION & DELETION ==================
window.createNewRequest = () => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.createNewRequest === 'function') {
            window.CollectionManager.createNewRequest();
        } else {
            console.warn('CollectionManager.createNewRequest not available yet');
        }
    } catch (error) {
        console.error('Error in createNewRequest:', error);
    }
};

window.deleteRequest = (collectionId, requestIndex, fromFolder = null) => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.deleteRequest === 'function') {
            window.CollectionManager.deleteRequest(collectionId, requestIndex, fromFolder);
        } else {
            console.warn('CollectionManager.deleteRequest not available yet');
        }
    } catch (error) {
        console.error('Error in deleteRequest:', error);
    }
};

window.duplicateRequest = (collectionId, requestIndex, folderId = '') => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.duplicateRequest === 'function') {
            window.CollectionManager.duplicateRequest(collectionId, requestIndex, folderId || null);
        } else {
            console.warn('CollectionManager.duplicateRequest not available yet');
        }
    } catch (error) {
        console.error('Error in duplicateRequest:', error);
    }
};

window.switchResponseTab = (tabName) => {
    try {
        if (window.RequestManager && typeof window.RequestManager.switchResponseTab === 'function') {
            window.RequestManager.switchResponseTab(tabName);
        } else {
            console.warn('RequestManager.switchResponseTab not available yet');
        }
    } catch (error) {
        console.error('Error in switchResponseTab:', error);
    }
};

window.saveCurrentRequest = async () => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.saveCurrentRequest === 'function') {
            await window.CollectionManager.saveCurrentRequest();
        } else if (window.RequestManager && typeof window.RequestManager.saveCurrentRequest === 'function') {
            await window.RequestManager.saveCurrentRequest();
        } else {
            console.warn('saveCurrentRequest not available yet');
        }
    } catch (error) {
        console.error('Error in saveCurrentRequest:', error);
    }
};

// Enhanced loadRequestToWorkspace
window.loadRequestToWorkspace = (collectionId, requestIndex) => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.loadRequestFromCollection === 'function') {
            window.CollectionManager.loadRequestFromCollection(collectionId, requestIndex);
            
            // Update active state
            document.querySelectorAll('.request-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked item
            const clickedItem = document.querySelector(`[onclick*="loadRequestToWorkspace('${collectionId}', ${requestIndex})"]`);
            if (clickedItem) {
                clickedItem.classList.add('active');
            }
        } else {
            console.warn('CollectionManager.loadRequestFromCollection not available yet');
        }
    } catch (error) {
        console.error('Error in loadRequestToWorkspace:', error);
    }
};

// Enhanced loadFolderRequestToWorkspace
window.loadFolderRequestToWorkspace = (collectionId, folderId, requestIndex) => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.loadFolderRequestToWorkspace === 'function') {
            window.CollectionManager.loadFolderRequestToWorkspace(collectionId, folderId, requestIndex);
            
            // Update active state
            document.querySelectorAll('.request-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked item
            const clickedItem = document.querySelector(`[onclick*="loadFolderRequestToWorkspace('${collectionId}', '${folderId}', ${requestIndex})"]`);
            if (clickedItem) {
                clickedItem.classList.add('active');
            }
        } else {
            console.warn('CollectionManager.loadFolderRequestToWorkspace not available yet');
        }
    } catch (error) {
        console.error('Error in loadFolderRequestToWorkspace:', error);
    }
};
// ================== DRAG & DROP SUPPORT ==================
window.enableDragAndDrop = () => {
    try {
        if (window.CollectionManager && typeof window.CollectionManager.enableDragAndDrop === 'function') {
            window.CollectionManager.enableDragAndDrop();
        } else {
            console.warn('CollectionManager.enableDragAndDrop not available yet');
        }
    } catch (error) {
        console.error('Error in enableDragAndDrop:', error);
    }
};

console.log('✅ Enhanced global function aliases set up successfully');
</script>

<script>
// Ensure collection is selected when app loads
document.addEventListener('DOMContentLoaded', () => {
    // Wait for managers to load, then ensure collection selection
    setTimeout(() => {
        if (window.CollectionManager && window.CollectionManager.ensureCollectionSelected) {
            window.CollectionManager.ensureCollectionSelected();
        }
    }, 2000);
});

</script>
    <script src="js/response-display-helper.js"></script>
    <script src="js/ui-layout-helper.js"></script>
</body>
</html>